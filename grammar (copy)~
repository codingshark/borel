%{
#include <string>
#include "grammar.tab.h"

using std::string;

extern "C" int yywrap();

string lex_str;

%}

%x CPP_COMMENT
%x C_COMMENT
%x PROLOGUE
%x DECLARATIONS


%%

<<EOF>>    {return 0;}


"{%"			{BEGIN PROLOGUE;}
<PROLOGUE>	"%}"	{BEGIN 0;}
<PROLOGUE>	.	{lex_str = string(yytext); return PROLOGUE;}


"%%"			{BEGIN DECLARATIONS;}
<DECLARATIONS>	"%%"	{BEGIN 0;}
<DECLARATIONS>	"|"	|
		";"	|	{return yytext[0];}

<DECLARATIONS>	"//"	{BEGIN CPP_COMMENT;}
<CPP_COMMENT>	\n	{BEGIN 0;}
<CPP_COMMENT>	.	//keep silent

<DECLARATIONS>	"/*"	{BEGIN CPP_COMMENT;}
<CPP_COMMENT>	"*/"	{BEGIN 0;}
<CPP_COMMENT>	.	//keep silent

<DECLARATIONS>	.	{lex_str = string(yytext); return DECLARATIONS;}

.|\n    {lex_str = string(yytext); return EPILOGUE;}

%%

int yywrap()
{
    return 1;
}
